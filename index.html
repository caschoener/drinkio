<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>drink.io</title>
    <link rel="icon" href="static/favicon.ico">
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script type="module">

        const socket = new WebSocket("ws://192.168.86.42:8765");
        const e = React.createElement;
        var drinks = {};

        class Header extends React.Component{
            constructor(props){
                super(props);
            }
            render(){
                return e('div', {className: "header"}, "drink.io");
            }
        }

        class Status extends React.Component{
            constructor(props){
                super(props);
            }

            getPosition(){
                return 3;
            }

            getDrink(){
                return "None";
            }

            getTime(){
                return "n/a";
            }

            getButtonClass(){
                return "";
            }

            getButtonText(){
                return "Pour";
            }

            render(){
                return e('div', {className: "status"}, [
                    e('div', {key: 0, className: "status-drink"}, "Queued Drink: "+this.getDrink()),
                    e('div', {key: 1, className: "status-position"}, "Queue Position: "+this.getPosition()),
                    e('div', {key: 2, className: "status-time"}, "Pour Within: "+this.getTime()),
                    e('div', {key: 3, onClick: (event)=>this.button(event), className: "button-pour "+this.getButtonClass()}, this.getButtonText())
                ]);
            }
        }

        class DrinkItem extends React.Component {
            constructor(props){
                super(props);
                
            }

            state = {
                expanded: false
            }

            press(event){
                if(this.props.active){
                    this.props.updateState({selected: null});
                }else{
                    this.props.updateState({selected: this.props.name});
                }
            }

            button(event){
                window.navigator.vibrate(200);
                event.stopPropagation()
            }

            getClass(condition, style) {
                if(condition){
                    return style;
                }
                return "";
            }

            render() {
                this.ingredientDetails = [];
                this.ingredientSummary = "";
                var i = 7;
                for(var key in drinks[this.props.name]){
                    this.ingredientDetails.push(e('div', {key: i, className: "ingredient-detail "+this.getClass(!this.props.active, "collapsed invisible")}, key + ": " + drinks[this.props.name][key] + " oz"));
                    this.ingredientSummary += key + ", ";
                    i++;
                }
                return e('div', {onClick: (event)=>this.press(event), className: "item"}, [
                    e('div', {key: 0, className: "title"}, this.props.name),
                    e('div', {key: 1, className: "ingredient-summary "+this.getClass(this.props.active, "invisible")}, this.ingredientSummary),
                    e('div', {key: 2, className: "arrow-wrapper "+this.getClass(this.props.active, "flip")}, 
                        e('div', {key: 3, className: "arrow"})
                    ),
                    e('div', {key: 4, className: "spacer "+this.getClass(!this.props.active, "collapsed")}, null),
                    this.ingredientDetails,
                    e('div', {key: 5, className: "spacer "+this.getClass(!this.props.active, "collapsed")}, null),
                    e('div', {key: 6, onClick: (event)=>this.button(event), className: "button-add "+this.getClass(!this.props.active, "collapsed invisible")}, "Add to Queue")
                ]);
            }
        }

        class DrinkList extends React.Component {
            constructor(props){
                super(props);
            }
            render() {
                this.list = []
                for(var drink in this.props.drinks){
                    this.list.push(e(DrinkItem, {key: drink, name: drink, active: drink==this.props.selected, updateState: this.props.updateState}, null));
                }
                return e('div', null, this.list);
            }
        }

        class App extends React.Component {
            constructor(){
                super();
            }

            state = {
                drinks: null,
                selected: null,
                updateState: this.changeState.bind(this)
            }

            changeState(newState){
                this.setState(newState);
            }

            componentDidMount(){
                socket.onopen = function () {
                    socket.send("Hello server");
                }

                socket.onmessage = (event)=>{
                    var msg = JSON.parse(event.data);
                    for(var key in msg){
                        switch(key){
                            case 'drinks': 
                                drinks = msg.drinks;
                                this.setState({ drinks: drinks });
                                break;
                            default:
                                break;
                        }
                    }
                    
                    console.log(msg);
                }
            }

            render() {
                return [
                    e(DrinkList, {key: 0, drinks: this.state.drinks, selected: this.state.selected, updateState: this.state.updateState}, null),
                    e(Status, {key: 1}, null)
                ];
            }
        }

        ///////////////////////////////////////////////////////////////

        var app = e(App, null, null);

        ReactDOM.render(
            app, 
            document.getElementById('root')
        );

        ////////////////////////////////////////////////////////////////
        
    </script>
    <style>
        body{
            margin: 0;
            background-image: linear-gradient(to bottom right, hsl(180deg 100% 25%), hsl(340deg 100% 25%));
            touch-action: manipulation;
            user-select: none;
            font-family: arial;
            background-attachment: fixed;
        }
        .item{
            transition: 200ms;
            background-color: hsl(0deg 0% 0% / 60%);
            color: hsl(0deg 0% 100% / 80%);
            font-size: 18px;
            margin: 6px;
            padding: 18px;
            border-radius: 6px;
            box-shadow: 0 0 16px 4px rgb(0 0 0 / 25%);
        }
        .title{
            width: 44%;
            height: 18px;
            line-height: 18px;
            display: inline-block;
        }
        .arrow-wrapper{
            display: inline-block;
            width: 6%;
            height: 18px;
            transition: 200ms;
        }
        .arrow{
            height: 12px;
            width: 12px;
            border-left: solid 2px;
            border-bottom: solid 2px;
            transform: rotateZ(-45deg);
            margin: auto;
        }
        .ingredient-summary{
            color: hsl(0deg 0% 100% / 60%);
            width: 36%;
            display: inline-block;
            text-overflow: clip;
            height: 18px;
            line-height: 18px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 11px;
            margin: 0 7%;
            transition: 200ms;
        }
        .ingredient-detail{
            color: hsl(0deg 0% 100% / 60%);
            white-space: pre-wrap;
            line-height: 24px;
            font-size: 15px;
            height: 24px;
            margin-left: 18px;
            overflow: hidden;
            transition: 200ms;
        }
        .button-add{
            font-size: 18px;
            height: 44px;
            line-height: 44px;
            margin: 0 20%;
            overflow: hidden;
            background-image: linear-gradient(to bottom right, hsl(340deg 100% 35%), hsl(180deg 100% 35%));
            background-attachment: fixed;
            box-shadow: 0 0 16px 2px rgb(0 0 0 / 25%);
            border-radius: 6px;
            text-align: center;
            transition: 200ms;
        }
        .button-pour{
            font-size: 18px;
            position: absolute;
            height: 44px;
            top: 18px;
            right: 18px;
            width: 25%;
            line-height: 44px;
            overflow: hidden;
            background-image: linear-gradient(to bottom right, hsl(340deg 100% 35%), hsl(180deg 100% 35%));
            background-attachment: fixed;
            box-shadow: 0 0 16px 2px rgb(0 0 0 / 25%);
            border-radius: 6px;
            text-align: center;
            transition: 200ms;
            display: inline-block;
        }
        .status-drink{
            position: absolute;
            height: 16px;
            line-height: 16px;
            top: 12px;
            left: 16px;
            font-size: 13px;
        }
        .status-position{
            position: absolute;
            height: 16px;
            line-height: 16px;
            top: 32px;
            left: 16px;
            font-size: 13px;
        }
        .status-time{
            position: absolute;
            height: 16px;
            line-height: 16px;
            top: 52px;
            left: 16px;
            font-size: 13px;
        }
        .status{
            background-image: linear-gradient(to bottom right, hsl(180deg 100% 8%), hsl(340deg 100% 8%));
            background-attachment: fixed;
            text-align: center;
            color: hsl(0deg 0% 100% / 80%);
            font-size: 18px;
            height: 80px;
            position: sticky;
            bottom: 0;
            box-shadow: 0 0 16px 6px rgb(0 0 0 / 60%);
        }
        .spacer{
            height: 12px;
            transition: 200ms;
        }
        .collapsed{
            height: 0;
        }
        .invisible{
            opacity: 0%;
        }
        .flip{
            transform: scaleY(-1);
        }
    </style>
</head>

<body>
    <div id="root"></div>
</body>

</html>
